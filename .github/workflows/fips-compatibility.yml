# FIPS Compatibility Check Workflow
# Checks code and dependencies for FIPS 140-2/140-3 compliance issues.
#
# FIPS (Federal Information Processing Standards) mode restricts cryptographic
# algorithms to NIST-approved ones. This is required for:
#   - US Government systems
#   - Healthcare (HIPAA)
#   - Financial services
#   - Ubuntu LTS with fips-updates package
#
# Features:
#   - Static analysis for non-FIPS crypto usage
#   - Dependency scanning for problematic packages
#   - Optional strict mode for zero-tolerance
#
# Uses reusable workflow from: ByronWilliamsCPA/.github
name: FIPS Compatibility

on:
  push:
    branches: [main, master]
    paths:
      - 'src/**/*.py'
      - 'pyproject.toml'
      - 'requirements*.txt'
      - '.github/workflows/fips-compatibility.yml'
  pull_request:
    branches: [main, master]
    paths:
      - 'src/**/*.py'
      - 'pyproject.toml'
      - 'requirements*.txt'
  schedule:
    # Run weekly on Monday at 10 AM UTC
    - cron: '0 10 * * 1'
  workflow_dispatch:
    inputs:
      strict_mode:
        description: 'Treat warnings as errors'
        required: false
        default: false
        type: boolean

# Cancel in-progress runs for same PR/branch
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: write

jobs:
  fips-check:
    uses: ByronWilliamsCPA/.github/.github/workflows/python-fips-compatibility.yml@main
    with:
      strict-mode: ${{ github.event.inputs.strict_mode == 'true' }}
      include-tests: true
      fix-hints: true
      artifact-retention-days: 30
      python-version: '3.12'
      enable-runtime-test: ${{ github.event_name == 'schedule' }}
