# Qlty Configuration for Python Libs
# This configuration uses Qlty for unified code quality analysis.
# Note: Most security tools run via pre-commit hooks instead.
#
# For configuration reference: https://qlty.sh/d/qlty-toml
config_version = "0"

# Default source for plugin definitions
[[source]]
name = "default"
default = true

# Note: File exclude and test patterns are configured at the top-level
# exclude_patterns and test_patterns are not supported in [[source]] blocks

# ============================================================================
# Python Linting and Formatting - Ruff
# ============================================================================
# Ruff is an extremely fast Python linter and code formatter written in Rust.
# It replaces Flake8, Black, isort, pyupgrade, and more.
# Configuration: pyproject.toml [tool.ruff] section
#
# Note: Qlty auto-detects Ruff from pyproject.toml.
# To enable Ruff plugin:
#   qlty plugins enable ruff
#
# Ruff configuration is in pyproject.toml [tool.ruff] section.
# See: https://docs.qlty.sh/analysis/coverage-linters#ruff

# ============================================================================
# Code Quality Metrics - Maintainability and Complexity
# ============================================================================
# Qlty's built-in code smell detection for identifying complex,
# hard-to-maintain code patterns.

[smells]
# Mode: comment (add PR comments) vs block (fail CI)
mode = "comment"

# Boolean logic complexity
[smells.boolean_logic]
enabled = true
threshold = 5  # Max boolean operators in a single expression

# Nested control flow (if/for/while nesting)
[smells.nested_control_flow]
enabled = true
threshold = 4  # Max nesting depth

# Function parameters
[smells.function_parameters]
enabled = true
threshold = 7  # Max parameters per function

# Return statements
[smells.return_statements]
enabled = true
threshold = 5  # Max return statements per function

# File complexity
[smells.file_complexity]
enabled = true
threshold = 500  # Max lines of code per file

# Function complexity (cyclomatic complexity)
[smells.function_complexity]
enabled = true
threshold = 10  # Google/Pylint standard for maintainable functions

# ============================================================================
# Python-Specific Code Quality Configuration
# ============================================================================
# Override smell thresholds for Python to match Google coding standards

[language.python.smells]
# Slightly more permissive than base threshold for Python's expressive features
# (decorators, context managers, async/await) but still maintains quality
function_complexity.threshold = 12

# Python's comprehensions can have complex boolean logic
boolean_logic.threshold = 6

# Allow larger Python files for models, views, etc.
file_complexity.threshold = 750

# ============================================================================
# Plugins - Using default source
# ============================================================================

# Python linting with Ruff
[[plugin]]
name = "ruff"
drivers = ["lint"]

# Python security with Bandit (comment mode - subprocess use is intentional for validation)
# Note: B101 (assert) warnings in tests are expected - nosec comments inline or ignored
# Note: Bandit configured in pyproject.toml to skip tests directory
[[plugin]]
name = "bandit"
mode = "comment"

# Shell script linting (comment mode - script styling preferences)
[[plugin]]
name = "shellcheck"
mode = "comment"

# YAML linting (comment mode - don't block CI for formatting)
[[plugin]]
name = "yamllint"
mode = "comment"

# Markdown linting (comment mode - don't block CI)
[[plugin]]
name = "markdownlint"
mode = "comment"

# GitHub Actions linting (comment mode - empty string in options is intentional)
[[plugin]]
name = "actionlint"
mode = "comment"

# Vulnerability scanning (comment mode - vulnerabilities reported but don't block)
[[plugin]]
name = "osv-scanner"
mode = "comment"

# ============================================================================
# Note on Security Scanning
# ============================================================================
# Additional security tools run via pre-commit hooks:
# - detect-secrets: Secrets detection
# - safety: Dependency vulnerability scanning
#
# See .pre-commit-config.yaml for the full security tool configuration.
